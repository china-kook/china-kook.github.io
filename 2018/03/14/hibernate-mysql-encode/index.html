<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Favicon -->
  

  <!-- Title -->
  
  <title>Hibernate 插入中文乱码 - ikook Blog</title>

  <!--Description-->
  
      <meta name="description" content="一切终将逝去，只要死神永生">
  

  <!--Author-->
  
      <meta name="author" content="ikook">
  

  <!--Open Graph Title-->
  
      <meta property="og:title" content="Hibernate 插入中文乱码"/>
  

  <!--Open Graph Site Name-->
  <meta property="og:site_name" content="ikook Blog"/>

  <!-- Pure CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/css?family=EB+Garamond|Montserrat:300" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Google Analytics -->
  

</head>


  <body>

		<div class="container my-4">
  <nav class="navbar navbar-toggleable-sm navbar-light px-1 py-3 my-3 mb-sm-3">
    <a class="navbar-brand ml-2" href="/"><span class="title">ikook Blog</span></a>
    <button class="navbar-toggler navbar-toggler-right py-2" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse text-center mt-3 mt-md-0" id="navbarCollapse">
      <ul class="navbar-nav ml-auto my-auto">
        
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
        
          <li class="nav-item">
            <a class="nav-link" href="/about">About</a>
          </li>
        
          <li class="nav-item">
            <a class="nav-link" href="/contact">Contact</a>
          </li>
        
      </ul>
      <hr class="hidden-md-up" />
    </div>
  </nav>
</div>


		<div class="container">
			
<div class="row">
  <div class="col-12 col-lg-8 offset-lg-2 mt-4">

    <div class="post-page text-center my-4">
      <h1>Hibernate 插入中文乱码</h1>
      <hr>
      <span class="date">2018-03-14</span>
    </div>

    <p>近些日子在折腾 Hibernate，遇到一个小问题：向 MySQL 数据库插入中文数据的时候会发现乱码，乱码形式表现为“?”。看到第一反应是：这还不简单，MySQL 建表时使用的是默认字符集，改成「UTF-8」不就得了。那就改啊，改完之后测试，顿时感觉心凉了一下。提示错误信息：</p>
<blockquote>
<p>org.hibernate.exception.GenericJDBCException: could not execute statement</p>
</blockquote>
<p>我擦，这是什么鬼？刚开始玩 Hibernate 的我一脸懵逼，还能怎么办，Google 啊。</p>
<p>按照网上的解决办法就是在 Hibernate 核心配置文件中的数据库连接 url 后面添加如下代码：</p>
<blockquote>
<p>?useUnicode=true&amp;characterEncoding=utf-8 </p>
</blockquote>
<p>再次测试，结果还是上面的错误信息，这就尴尬了。再查，发现我的 MySQL 数据库没有更改默认字符集，MySQL 的默认字符集是“latin1”（鬼知道 MySQL 设计者为什么弄它作为默认字符集）。开整。</p>
<p>可以通过在终端进入 MySQL 然后输入：show variables like ‘%char%’; 查看字符集。</p>
<center><br><img src="https://meto.chinakook.com/blog-images/180314-01.jpeg" alt=""><br></center>

<p>图中标注的地方是更改之后，更改之前应该是「latin1」。想要更改 MySQL 的编码，就需要修改 MySQL 配置文件：my.cnf。修改配置文件之前一定要将 MySQL 进程关闭，一定要，不然会出现麻烦。</p>
<p>将 MySQL 安装目录下的my.cnf文件复制到/etc目录下（如果 MySQL 安装目录没有 my.cnf 文件，则直接在/etc中新建一个名为 my.cnf 的文件）</p>
<p>my.cnf 文件内容如下：</p>
<center><br><img src="https://meto.chinakook.com/blog-images/180314-02.jpeg" alt=""><br></center>

<p>在 my.cnf 文件中添加图中标注的内容。完整内容在我的公众号后台回复「my.cnf」获取。对了，Mac 下是 my.cnf 文件，windows 对应的配置文件名是 my.ini</p>
<p>更改完重启 MySQL 测试，心想这下应该可以了吧，然而，还是出现那个错误信息。别慌，Hibernate 要操作的数据库是更改默认编码之前创建的，所以去更改下待操作的数据库的字符集（一开始只更改了表的字符集）。再测试，OK。</p>
<p>所以问题的根本在于数据库的编码。那折腾半天 MySQL 默认编码干啥？直接更改待操作数据库的字符集不就得了？更改 MySQL 默认编码之后再创建新的数据库，就不用再去手动设置字符集，省去了以后的麻烦，也算自己没白折腾。</p>
<p><br>ikook<br>2018.03.14</p>


    


  </div>
</div>



			<footer class="text-center mt-5 py-5">
  
  
    <a href="https://twitter.com/?lang=en" target="_blank"><i class="fa fa-twitter mr-4"></i></a>
  
  
    <a href="https://www.facebook.com/" target="_blank"><i class="fa fa-facebook mr-4"></i></a>
  
  
    <a href="https://www.instagram.com/" target="_blank"><i class="fa fa-instagram mr-4"></i></a>
  
  
    <a href="https://www.linkedin.com/" target="_blank"><i class="fa fa-linkedin mr-4"></i></a>
  
  
  
  
  
  
</footer>

		</div>

		<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

<!-- Disqus Comments -->



  </body>
</html>
